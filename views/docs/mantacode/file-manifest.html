{%= extends 'layout.html' %}

{%= block content %}
  <div class="row">
    <div class="col-xs-12">
      <div class="row">
        <div class="mlm plm col-xs-2">
          <div class="list-group fixed-sidebar-top" data-spy="affix" data-offset-top="1">
            <a id="github-{{= module.name }}" ng-init="mixpanel.track_links('#github-{{= module.name }}', 'Click', { target: 'github', module: '{{= module.name }}', action: 'view' })" href="https://github.com/{{= author }}/{{= module.name }}" target="_blank" class="list-group-item"><span class="fa fa-github"></span><span class="mls">View it on Github</span></a>
            <a id="fork-{{= module.name }}" ng-init="mixpanel.track_links('#fork-{{= module.name }}', 'Click', { target: 'github', module: '{{= module.name }}', action: 'fork' })" href="https://github.com/{{= author }}/{{= module.name }}/fork" target="_blank" class="list-group-item"><span class="fa fa-code-fork"></span><span class="mls">Fork it</span></a>
            <a id="npm-{{= module.name }}" ng-init="mixpanel.track_links('#npm-{{= module.name }}', 'Click', { target: 'npm', module: '{{= module.name }}', action: 'view' })" href="https://www.npmjs.org/package/{{= module.name }}" target="_blank" class="list-group-item"><span class="ta ta-npm"></span><span class="mls">View it on npm</span></a>
            <a href="http://twitter.com/share" tweet='Check out "{{= module.name }}" at' tweet-tags="nodejs" tweet-topic="{{= module.name }}" class="list-group-item"><span class="fa fa-twitter"></span><span class="mls">Tweet it</span></a>
            {%= if module.coverage %}
              <a href="/coverage/{{= module.name }}" ng-init="mixpanel.track_links('#btn-coverage-{{= module.name }}', 'Click', { target: 'coverage', module: '{{= module.name }}', action: 'view' })" class="list-group-item"><span class="fa fa-code"></span><span class="mls">View test coverage</span></a>
            {%= endif %}
          </div>
          <div class="list-group text-center fixed-sidebar" data-spy="affix" data-offset-top="1" style="font-size: 20pt;">
            <a id="btn-github-{{= module.name }}" ng-init="mixpanel.track_links('#btn-github-{{= module.name }}', 'Click', { target: 'github', page: '{{= module.name }}' })" href="https://github.com/{{= author }}/{{= module.name }}" target="_blank" class="list-group-item" title="View it on Github"><span class="fa fa-github"></span></a>
            <a id="btn-fork-{{= module.name }}" ng-init="mixpanel.track_links('#btn-fork-{{= module.name }}', 'Click', { target: 'github', page: 'fork {{= module.name }}' })" href="https://github.com/{{= author }}/{{= module.name }}/fork" target="_blank" class="list-group-item" title="Fork it"><span class="fa fa-code-fork"></span></a>
            <a id="btn-npm-{{= module.name }}" ng-init="mixpanel.track_links('#btn-npm-{{= module.name }}', 'Click', { target: 'npm', page: '{{= module.name }}' })" href="https://www.npmjs.org/package/{{= module.name }}" target="_blank" class="list-group-item" title="View it on npm"><span class="ta ta-npm"></span></a>
            <a href="http://twitter.com/share" tweet='Check out "{{= module.name }}" at' tweet-tags="nodejs" tweet-topic="{{= module.name }}" class="list-group-item" title="Tweet it"><span class="fa fa-twitter"></span></a>
            {%= if module.coverage %}
              <a id="btn-coverage-{{= module.name }}" ng-init="mixpanel.track_links('#btn-coverage-{{= module.name }}', 'Click', { target: 'coverage', page: '{{= module.name }}' })" href="/coverage/{{= module.name }}" class="list-group-item" title="View test coverage"><span class="fa fa-code"></span></a>
            {%= endif %}
          </div>
        </div>
        <div class="col-xs-9">
          <p><a href="https://travis-ci.org/mantacode/file-manifest"><img src="https://travis-ci.org/mantacode/file-manifest.png" alt="Build Status"></a> <a href="https://npmjs.org/package/file-manifest"><img src="http://img.shields.io/npm/dm/file-manifest.svg" alt="downloads"></a> <a href="https://npmjs.org/package/file-manifest"><img src="http://img.shields.io/npm/v/file-manifest.svg" alt="npm"></a> <a href="https://codeclimate.com/github/mantacode/file-manifest"><img src="https://codeclimate.com/github/mantacode/file-manifest/badges/gpa.svg" alt="Code Climate"></a> <a href="https://codeclimate.com/github/mantacode/file-manifest"><img src="https://codeclimate.com/github/mantacode/file-manifest/badges/coverage.svg" alt="Test Coverage"></a> <a href="https://david-dm.org/mantacode/file-manifest"><img src="https://david-dm.org/mantacode/file-manifest.png" alt="dependencies"></a></p>
<p><a href="https://nodei.co/npm/file-manifest.png?downloads=true"><img src="https://nodei.co/npm/file-manifest.png?downloads=true" alt="NPM info"></a></p>
<h1 id="file-manifest">File-Manifest</h1>
<p>Require all the files in a directory into a single object</p>
<h2 id="installation">Installation</h2>
<p><code ng-non-bindable="">npm install file-manifest --save</code></p>
<h2 id="usage">Usage</h2>
<p>File-manifest recursively requires everything in a given directory (optionally filtered with globstar patterns) and packages it into a single object where the keys are (by default) camel-cased file names. Thus if you had a directory called <code ng-non-bindable="">foo</code>, whose structure looked like this:</p>
<pre><code ng-non-bindable="">bar
baz
  quux
  some-long-name</code></pre>
<p>You&apos;d end up with an object that looked like this:</p>
<pre><code class="lang-javascript" ng-non-bindable="">{
  fooBar: // foo/bar&apos;s exports
  fooBazQuux: //foo/baz/quux&apos;s exports
  fooBazSomeLongName: // foo/baz/some-long-name&apos;s exports
}</code></pre>
<p>This is useful (for example) in an express app to create a route manifest:</p>
<pre><code class="lang-javascript" ng-non-bindable="">var routes = require(&apos;file-manifest&apos;).generate(&apos;routes&apos;);

app.get(&apos;/&apos;, routes.home);
app.get(&apos;/users/:id&apos;, routes.profile);
// etc.</code></pre>
<p>or a middleware manifest:</p>
<pre><code class="lang-javascript" ng-non-bindable="">var middleware = require(&apos;file-manifest&apos;).generate(&apos;middleware&apos;);

app.use(middleware.setOriginPolicy);
app.use(middleware.defaultLogger);
// etc.</code></pre>
<p>or in a mongoose app to load all models:</p>
<pre><code class="lang-javascript" ng-non-bindable="">var models = require(&apos;file-manifest&apos;).generate(&apos;models&apos;);
module.exports = function(req, res, next) {
  req.models = models;
  next();
};</code></pre>
<h3 id="sync">Sync</h3>
<p>As demonstrated above, just call <code ng-non-bindable="">.generate</code> with a relative or absolute path.</p>
<pre><code class="lang-javascript" ng-non-bindable="">var manifest = require(&apos;file-manifest&apos;).generate(&apos;some/dir&apos;);</code></pre>
<h3 id="async">Async</h3>
<p>Just like sync, but accepts a callback. It is important that the first argument to this function start with <code ng-non-bindable="">err</code> (more on this below).</p>
<pre><code class="lang-javascript" ng-non-bindable="">require(&apos;file-manifest&apos;).generate(&apos;some/dir&apos;, function(err, manifest) {
  // . . .
});</code></pre>
<h3 id="with-patterns">With Patterns</h3>
<p>Both sync and async versions accept a string pattern or list of string patterns to filter (see <a href="https://github.com/isaacs/minimatch">minimatch</a> for more on globstar patterns).</p>
<pre><code class="lang-javascript" ng-non-bindable="">var manifest = require(&apos;file-manifest&apos;).generate(&apos;config&apos;, &apos;**/*.json&apos;);

// or

require(&apos;file-manifest&apos;).generate(&apos;config&apos;, [&apos;**/*.json&apos;, &apos;**/*.yml&apos;], function(err, manifest) {
  // . . .
});</code></pre>
<h3 id="with-a-custom-reduce">With a Custom Reduce</h3>
<p>File-manifest also gives you the option to provide a custom reduce function. This let&apos;s you alter the behavior of <code ng-non-bindable="">file-manifest</code> if simply requiring the files is insufficient (or you don&apos;t like camel-cased key names). This reduce function (as of v1.0.0) has the following signature - <code ng-non-bindable="">(options, manifest, fileObj, [callback])</code> - where <code ng-non-bindable="">options</code> is an object in the form:</p>
<pre><code class="lang-javascript" ng-non-bindable="">patterns: Array or String // Any matching patterns provided (or empty string if none)
dir: String // The directory to search
memo: Any // The starting value for the reduce function (defaults to {})
reducer: String or Function // The reduce function to call
require: String or Function // The function to get the current file (defaults to the build in require function)
namer: String or Function // The function to name the keys in the manifest</code></pre>
<p><code ng-non-bindable="">manifest</code> is the results of the reduce process so far (often called &quot;memo&quot; for reasons that aren&apos;t really clear to me), <code ng-non-bindable="">fileObj</code> is an object of file parts in the form:</p>
<pre><code class="lang-javascript" ng-non-bindable="">relativePath: String // The path of the file minus the original path (e.g. &quot;foo/bar.js&quot;)
relativeName: String // Like relativePath but without the extension. This is the part used for naming the keys (e.g. &quot;foo/bar&quot;)
fullPath: String // The full path of the file (e.g. &quot;/dir/foo/bar.js&quot;)
basename: String // The result of path.basename(fullPath) (e.g. &quot;bar.js&quot;)
name: String // Like basename but without the extension (e.g. &quot;bar&quot;)
ext: String // The file extension (e.g. &quot;.js&quot;)</code></pre>
<p>The callback will, of course, only be available in async implementations. You should manipulate the manifest and then return it (sync) or call the callback with an optional error and the new manifest (async).</p>
<pre><code class="lang-javascript" ng-non-bindable="">var manifest = require(&apos;file-manifest&apos;).generate(&apos;keywords&apos;, function(options, manifest, file) {
  var name = file.relativeName.split(&apos;/&apos;).join(&apos;|&apos;);
  manifest[name] = require(file.fullPath);
  return manifest;
});</code></pre>
<p>The sync implemenation uses <code ng-non-bindable="">_.reduce</code> (<a href="http://underscorejs.org/">underscore</a>), while the async version uses <code ng-non-bindable="">async.reduce</code> (<a href="https://github.com/caolan/async">async</a>), so see those for more information.</p>
<p>You might have noted that the same <code ng-non-bindable="">generate</code> function can take a reduce function, a callback, or both. The way <code ng-non-bindable="">file-manifest</code> distinguishes is by examining the last function to see if it&apos;s first parameter begins with <code ng-non-bindable="">err</code>. That&apos;s why all async implementations should pass a callback that accepts a variable named <code ng-non-bindable="">err</code> or <code ng-non-bindable="">error</code>.</p>
<p>If you are still using <code ng-non-bindable="">file-manifest@&lt;1.x</code>, the custom reduce function should accept only <code ng-non-bindable="">manifest</code>, <code ng-non-bindable="">file</code>, and (optionally) <code ng-non-bindable="">callback</code>. The <code ng-non-bindable="">file</code> is the absolute file path. The context of the function (i.e. <code ng-non-bindable="">this</code>) does have properties called <code ng-non-bindable="">dir</code>, which is the originally passed in path, and patterns, which is the original patterns. This just means you need to do some of the manipulation yourself. For example, the above function would be:</p>
<pre><code class="lang-javascript" ng-non-bindable="">var manifest = require(&apos;file-manifest&apos;).generate(&apos;keywords&apos;, function(manifest, file) {
  var name = file.replace(this.dir + &apos;/&apos;, &apos;&apos;).replace(path.extname(file), &apos;&apos;).split(&apos;/&apos;).join(&apos;|&apos;);
  manifest[name] = require(file);
  return manifest;
});</code></pre>
<h3 id="with-options">With options</h3>
<p>As of <code ng-non-bindable="">file-manifest@1.0.0</code>, you can also pass an <code ng-non-bindable="">options</code> object to file-manifest. The options object can have any of the following keys:</p>
<h4 id="patterns-and-reducer">Patterns and Reducer</h4>
<p>Same as the parameter counterparts above.</p>
<p>These can be passed as part of the object OR as separate parameters. If you&apos;re passing an options object, you should just add them to that. The separate parameters were only included to preserve (the appearance of) backward compatibility (v1.0.0 is not <em>really</em> backward compatible, but it takes a lot less to convert an old implementation with these parameters preserved).</p>
<h4 id="memo">Memo</h4>
<p><code ng-non-bindable="">memo</code> is the starting value for the reduce function. The default is <code ng-non-bindable="">{}</code>, but it is sometimes useful to use <code ng-non-bindable="">[]</code> or even something more complicated. Note, however, that the default reduce function expects an object, so if you want to do something different, you should supply a custom reducer. E.g.</p>
<pre><code class="lang-javascript" ng-non-bindable="">var manifest = require(&apos;file-manifest&apos;).generate(&apos;client/app/js&apos;, { memo: [], patterns: [&apos;**/*.js&apos;], reducer: function(options, manifest, file) {
  manifest.push(file.name);
  return manifest;
}});</code></pre>
<h4 id="require-and-namer">Require and Namer</h4>
<p>If you only want custom functionality for the way keys are generated or the way the file is read, you can also pass either (or both) of <code ng-non-bindable="">namer</code> and <code ng-non-bindable="">require</code>. The <code ng-non-bindable="">namer</code> function should accept the options object and the same file object that <code ng-non-bindable="">reduce</code> accepts and should return the key name. The <code ng-non-bindable="">require</code> function should accept <code ng-non-bindable="">options</code>, <code ng-non-bindable="">fileObj</code>, and optionally <code ng-non-bindable="">callback</code> and should return the corresponding value for the key (usually the exports or file contents) for sync implementations or call the callback with an optional error and the value for async implementations.</p>
<pre><code class="lang-javascript" ng-non-bindable="">var manifest = require(&apos;file-manifest&apos;).generate(&apos;partials&apos;, { namer: function(options, file) { return file.relativeName.split(&apos;/&apos;).join(&apos;-&apos;); }, require: function(options, file, cb) {
  fs.readFile(file.fullPath, &apos;utf8&apos;, cb);
}});</code></pre>
<p>Alternatively, since there are some common patterns, <code ng-non-bindable="">namer</code> can be a string - one of <code ng-non-bindable="">camelCase</code> (the default), <code ng-non-bindable="">dash</code>, <code ng-non-bindable="">slash</code>, <code ng-non-bindable="">pipe</code>, <code ng-non-bindable="">class</code>, <code ng-non-bindable="">lower</code>, <code ng-non-bindable="">upper</code>, <code ng-non-bindable="">underscore</code> or <code ng-non-bindable="">snake</code>, or <code ng-non-bindable="">human</code>. The results for the file &quot;foo/bar.js&quot; for each would be:</p>
<pre><code ng-non-bindable="">camelCase: &quot;fooBar&quot;,
dash: &quot;foo-bar&quot;,
slash: &quot;foo/bar&quot;,
pipe: &quot;foo|bar&quot;,
class: &quot;FooBar&quot;,
lower: &quot;foobar&quot;,
upper: &quot;FOOBAR&quot;,
underscore: &quot;foo_bar&quot;,
snake: &quot;foo_bar&quot;,
human: &quot;Foo bar&quot;</code></pre>
<p>Similarly, the <code ng-non-bindable="">require</code> option can be a string with either <code ng-non-bindable="">require</code> or <code ng-non-bindable="">readFile</code>. <code ng-non-bindable="">require</code> will use node&apos;s <code ng-non-bindable="">require</code> function (this is the default, so there&apos;s not much point in specifying this). <code ng-non-bindable="">readFile</code> will use <code ng-non-bindable="">readFileSync</code> (for sync implementations) or <code ng-non-bindable="">readFile</code> (for async implementations).</p>
<p>So the previous call to <code ng-non-bindable="">file-manifest</code> could be replaced with</p>
<pre><code class="lang-javascript" ng-non-bindable="">var manifest = require(&apos;file-manifest&apos;).generate(&apos;partials&apos;, { namer: &apos;dash&apos;, require: &apos;readFile&apos; });</code></pre>
<p><br><br><br>
*Note: This <em>probably</em> goes without saying, but &quot;an optional error&quot; (throughout) means that it may be <code ng-non-bindable="">null</code> or <code ng-non-bindable="">undefined</code>, not that it may be omitted.</p>

        </div>
      </div>
    </div>
  </div>
{%= endblock %}
